<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBS Member Portal</title>

<link rel="manifest" href="/mbsmember/manifest.json">
<link rel="apple-touch-icon" href="/mbsmember/logo-192.png">
<link rel="icon" type="image/png" href="/mbsmember/logo-192.png">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body{
margin:0;
font-family:system-ui,-apple-system,sans-serif;
background:linear-gradient(135deg,#0f172a,#1e3a8a);
height:100vh;
display:flex;
align-items:center;
justify-content:center;
color:white;
}

.card{
background:white;
color:#0f172a;
padding:35px;
border-radius:22px;
width:320px;
text-align:center;
box-shadow:0 20px 60px rgba(0,0,0,0.25);
animation:fade 0.6s ease;
}

.logo{
width:110px;
border-radius:18px;
margin-bottom:18px;
box-shadow:0 8px 25px rgba(0,0,0,0.15);
}

h1{
margin:0 0 8px;
font-size:1.4rem;
}

p{
color:#64748b;
font-size:0.95rem;
margin-bottom:18px;
}

button{
display:none;
background:#1e3a8a;
border:none;
color:white;
padding:12px 22px;
border-radius:40px;
font-weight:600;
cursor:pointer;
box-shadow:0 6px 18px rgba(30,58,138,0.35);
}

.loader{
border:3px solid #e2e8f0;
border-top:3px solid #1e3a8a;
border-radius:50%;
width:20px;
height:20px;
display:inline-block;
animation:spin 1s linear infinite;
}

@keyframes spin{
0%{transform:rotate(0)}
100%{transform:rotate(360deg)}
}

@keyframes fade{
from{opacity:0;transform:translateY(15px)}
to{opacity:1;transform:translateY(0)}
}
</style>
</head>

<body>

<div class="card">

<img src="/mbsmember/logo-192.png" class="logo">

<h1>MBS Member Portal</h1>

<div id="setupArea">
<p id="statusText">Menyediakan aplikasi...</p>
<button id="installBtn" style="display:none;">Pasang Aplikasi</button>
</div>

<div id="loadingArea" style="display:none">
<p><span class="loader"></span> Membuka Portal...</p>
</div>

</div>

<script>

// ===== Service Worker (WAJIB untuk PWA) =====
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}

let deferredPrompt;
let installAccepted = false;

const installBtn=document.getElementById('installBtn');
const statusText=document.getElementById('statusText');
const setupArea=document.getElementById('setupArea');
const loadingArea=document.getElementById('loadingArea');

// ===== 如果已安装 → 秒进 =====
if(window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone){
  openPortal();
}

// ===== Android Install Event =====
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display='inline-block';
  statusText.innerText="Pasang aplikasi untuk akses pantas";
});

// ===== Install Button Click =====
installBtn.onclick=async()=>{
  if(!deferredPrompt) return;

  // Papar mesej sedang install
  statusText.innerHTML=
  "<b>Sedang memasang aplikasi...</b><br>" +
  "Jangan tutup browser";
  
  installBtn.style.display='none';

  deferredPrompt.prompt();

  const { outcome } = await deferredPrompt.userChoice;

  if(outcome === "accepted"){
    installAccepted = true;
  }else{
    statusText.innerText="Pemasangan dibatalkan";
    installBtn.style.display='inline-block';
  }

  deferredPrompt=null;
};

// ===== 安装完成 =====
window.addEventListener('appinstalled',()=>{
  if(!installAccepted) return;

  // Kekalkan mesej 10 saat
  statusText.innerHTML=
  "<b>Sedang memasang aplikasi...</b><br>" +
  "Jangan tutup browser";

  setTimeout(()=>{
    statusText.innerHTML=
    "<b>Pemasangan berjaya!</b><br>Membuka portal...";
    
    openPortal();
  },8000); // ✅ 10 saat penuh
});

// ===== iOS 教学 =====
const isIOS=/iphone|ipad|ipod/i.test(navigator.userAgent);
if(isIOS && !window.navigator.standalone){
  statusText.innerHTML=
  "Tekan <b>Share</b> lalu pilih <b>Add to Home Screen</b>";
}

// ===== 打开 Portal =====
function openPortal(){
  setupArea.style.display='none';
  loadingArea.style.display='block';

  setTimeout(()=>{
    window.location.replace(
      "https://mbsbooksandstationerymember-sudo.github.io/mbsmember/member"
    );
  },1000);
}

</script>


</body>
</html>






